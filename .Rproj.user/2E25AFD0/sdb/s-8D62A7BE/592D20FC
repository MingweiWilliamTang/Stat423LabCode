{
    "contents" : "### install alr4 package (if need be) -- doesn't need to be done but once \n### install.packages(\"alr4\", dependencies=TRUE, repos=\"http://cran.fhcrc.org\")\n\n### load alr4 package -- needs to be done at start of R session\n\nlibrary(alr4)\n\n### reproduction of remaining Chapter 3 overheads ...\n\n### overhead III-47\n\npairs(~ WT18 + HT18 + LG18 + Soma, data=BGSgirls, col=\"blue\")\n\n### overhead III-48 ... enhanced scatterplot matrix \n\nscatterplotMatrix(BGSgirls[,c(\"WT18\",\"HT18\",\"LG18\",\"Soma\")])  # one way ...\n\nstr(BGSgirls)  # figure which columns correspond to which variables ...\n\nscatterplotMatrix(BGSgirls[,c(7,8,9,12)])  # .. another way\n\n### overhead III-49 ... calculation of sample covariance matrix\n\n(n.BGSgirls <- nrow(BGSgirls))  # 70\n\nround(cal.C.BGSgirls <- cov(BGSgirls[,c(7,8,9,12)]), 3)\n\n### overhead III-51 ... calculation of sample correlation matrix\n\nround(cor(BGSgirls[,c(7,8,9,12)]),4)\n\nround((n.BGSgirls-1)*cal.C.BGSgirls, 2)\n\n### overhead III-52 ... calculation of inverse of X'X\n\ncal.X.prime.cal.X.BGSgirls <- (n.BGSgirls-1) * cal.C.BGSgirls[1:3,1:3]\n### inverse of matrix\nround(cal.X.prime.cal.X.inv.BGSgirls <- solve(cal.X.prime.cal.X.BGSgirls), 7)\n\n\nX.BGSgirls <- as.matrix(cbind(rep(1, n.BGSgirls), BGSgirls[,c(\"WT18\",\"HT18\",\"LG18\")]))\ncolnames(X.BGSgirls)[1] <- \"Intercept\"\n### t-- matrix transpose\n### X'X\nXtX.BGSgirls <- t(X.BGSgirls) %*% X.BGSgirls\nround(XtXinv.BGSgirls <- solve(XtX.BGSgirls), 7)\n\n### overhead III-53 ... estimates of least squares parameters\n###(X-X_bar)'(Y-Y_bar)\ncal.X.prime.cal.Y.BGSgirls <- (n.BGSgirls-1)*as.vector(cal.C.BGSgirls[1:3,4])\ncal.Y.prime.cal.Y.BGSgirls <- (n.BGSgirls-1)*cal.C.BGSgirls[4,4]\n\nround(beta.hat.star.BGSgirls <- cal.X.prime.cal.X.inv.BGSgirls %*% cal.X.prime.cal.Y.BGSgirls,5)\n\nx.bars.y.bar.BGSgirls <- colMeans(BGSgirls[,c(7,8,9,12)])\n\nround(x.bars.y.bar.BGSgirls[1:3],5)\n\nround(beta.hat.0.BGSgirls <- as.vector(x.bars.y.bar.BGSgirls[4] - sum(beta.hat.star.BGSgirls*x.bars.y.bar.BGSgirls[1:3])),5)\n### RSS=\nround(RSS.BGSgirls <- as.vector(cal.Y.prime.cal.Y.BGSgirls - t(beta.hat.star.BGSgirls) %*% cal.X.prime.cal.X.BGSgirls %*% beta.hat.star.BGSgirls), 4)\n\nround(sigma.hat.2.BGSgirls <- RSS.BGSgirls/(n.BGSgirls-4), 4)\nround(sqrt(sigma.hat.2.BGSgirls), 4)\n\n### let's compare above with output from R's lm function ...\n\nlm.Soma.WT18.HT18.LG18 <- with(BGSgirls, lm(Soma ~ WT18 + HT18 + LG18))\n\nall.equal(as.vector(coef(lm.Soma.WT18.HT18.LG18)),c(beta.hat.0.BGSgirls,beta.hat.star.BGSgirls))  # TRUE\n\n### although not recommended, let's get least squares estimates\n### using uncorrected sum of squares also for comparison\n\nY.BGSgirls <- BGSgirls[,\"Soma\"]\nXtY.BGSgirls <- t(X.BGSgirls) %*% Y.BGSgirls\nbeta.hat.BGSgirls <- as.vector(XtXinv.BGSgirls %*% XtY.BGSgirls)\n\nall.equal(as.vector(coef(lm.Soma.WT18.HT18.LG18)),beta.hat.BGSgirls)  # TRUE, somewhat surprisingly\n\n### overhead III-54 ... extraction of standard errors\n\nround(diag(XtXinv.BGSgirls),7)\n### standard error\nround(sqrt(sigma.hat.2.BGSgirls*diag(XtXinv.BGSgirls)),5)\n\n### overhead III-56 ... R squared\n\nround(SYY.BGSgirls <- cal.Y.prime.cal.Y.BGSgirls, 4)  # 44.8179\nround(RSS.BGSgirls <- sum(resid(lm.Soma.WT18.HT18.LG18)^2), 4)  # 14.5546\nround(SSreg.BGSgirls <- SYY.BGSgirls - RSS.BGSgirls, 4)  # 30.2633\nround(R.squared.BGSgirls <- SSreg.BGSgirls/SYY.BGSgirls, 4)  # 0.6753\nround(R.squared.BGSgirls*100)  # 68\n\n### overhead III-58 ... summary of regression of Soma on WT18, HT18 and LG18\n\nsummary(lm.Soma.WT18.HT18.LG18)\n\n### overhead III-59 ... regression models needed for added-variable plot\n\nlm.Soma.HT18.LG18 <- with(BGSgirls, lm(Soma ~ HT18 + LG18))\n\nround(coef(lm.Soma.HT18.LG18),4)\n\nlm.WT18.HT18.LG18 <- with(BGSgirls, lm(WT18 ~ HT18 + LG18))\n\nround(coef(lm.WT18.HT18.LG18),4)\n\n### overhead III-60 ... added-variable plot\n\nscatterplot.with.reg.line <- function(xs, ys, xlab=NULL, ylab=NULL, loess.p=TRUE, label.me=NULL, pos=3, reg.line.p=TRUE, zero.line.p=FALSE)\n  {\n    plot(xs,ys,col=\"blue\",xlab=xlab,ylab=ylab,cex=0.75)\n    ols.xs.ys <- lm(ys ~ xs)\n    if(reg.line.p) abline(reg=ols.xs.ys, col=\"black\", lwd=2)\n    if(zero.line.p) abline(h=0, lty=\"dashed\", lwd=2)\n    if(loess.p)\n      {\n        loess.xs.ys <- loess(ys ~ xs)\n        xs.order <- order(xs)\n        lines(xs[xs.order], loess.xs.ys$fitted[xs.order], col=\"red\", lwd=2) \n      }\n    if(!is.null(label.me)) text(xs[label.me], ys[label.me], label.me, pos=pos)\n    ols.xs.ys\n  }\n\nlm.e.Soma.HT18.LG18.e.WT18.HT18.LG18 <- scatterplot.with.reg.line(resid(lm.WT18.HT18.LG18), resid(lm.Soma.HT18.LG18), xlab=expression(paste(hat (e), \" from WT18 on HT18 and LG18\")), ylab=expression(paste(hat (e), \" from Soma on HT18 and LG18\")), loess.p=FALSE)\n\n### identify case number for unusual point\n\ni.unusual <- identify(resid(lm.WT18.HT18.LG18), resid(lm.Soma.HT18.LG18),n=1)\ni.unusual  # 68\n\n### redo plot with unusual point marked ...\n\nlm.e.Soma.HT18.LG18.e.WT18.HT18.LG18 <- scatterplot.with.reg.line(resid(lm.WT18.HT18.LG18), resid(lm.Soma.HT18.LG18), xlab=expression(paste(hat (e), \" from WT18 on HT18 and LG18\")), ylab=expression(paste(hat (e), \" from Soma on HT18 and LG18\")), loess.p=FALSE, label.me=i.unusual)\n\n### overhead III-61 ... check that slope & coefficient estimates are the same\n\nall.equal(as.vector(coef(lm.e.Soma.HT18.LG18.e.WT18.HT18.LG18))[2],as.vector(coef(lm.Soma.WT18.HT18.LG18))[2])  # TRUE\n\n### t-test of beta_1 ...\n\n(t.test.beta.1.BGSgirls <- as.vector(coef(lm.e.Soma.HT18.LG18.e.WT18.HT18.LG18))[2]/sqrt((sum(resid(lm.e.Soma.HT18.LG18.e.WT18.HT18.LG18)^2)/(n.BGSgirls-4))/sum(resid(lm.WT18.HT18.LG18)^2)))  # 8.240339\n\n### get p-value ...\n\n2*(1-pt(abs(t.test.beta.1.BGSgirls),n.BGSgirls-4))  # 9.83591e-12\n\n### note: above is NOT the same t-test given in the following\n### (results similar, but details are different!)\n\nsummary(lm.e.Soma.HT18.LG18.e.WT18.HT18.LG18)  # t-test for beta_1\n\n### overhead III-63 ... second added-variable plot\n\nlm.HT18.WT18.LG18 <- with(BGSgirls, lm(HT18 ~ WT18 + LG18))\nlm.Soma.WT18.LG18 <- with(BGSgirls, lm(Soma ~ WT18 + LG18))\n\nlm.e.Soma.WT18.LG18.e.HT18.WT18.LG18 <- scatterplot.with.reg.line(resid(lm.HT18.WT18.LG18), resid(lm.Soma.WT18.LG18), xlab=expression(paste(hat (e), \" from HT18 on WT18 and LG18\")), ylab=expression(paste(hat (e), \" from Soma on WT18 and LG18\")), loess.p=FALSE)\n\n### identify case number for unusual point\n\ni.unusual <- identify(resid(lm.HT18.WT18.LG18), resid(lm.Soma.WT18.LG18),n=1)\ni.unusual  # 68\n\n### redo plot with unusual point marked ...\n\n### lm.e.Soma.WT18.LG18.e.HT18.WT18.LG18 <- scatterplot.with.reg.line(resid(lm.HT18.WT18.LG18), resid(lm.Soma.WT18.LG18), xlab=expression(paste(hat (e), \" from HT18 on WT18 and LG18\")), ylab=expression(paste(hat (e), \" from Soma on WT18 and LG18\")), loess.p=FALSE, label.me=i.unusual)\n\n### overhead III-64 ... third added-variable plot\n\nlm.LG18.WT18.HT18 <- with(BGSgirls, lm(LG18 ~ WT18 + HT18))\nlm.Soma.WT18.HT18 <- with(BGSgirls, lm(Soma ~ WT18 + HT18))\n\nlm.e.Soma.WT18.HT18.e.LG18.WT18.HT18 <- scatterplot.with.reg.line(resid(lm.LG18.WT18.HT18), resid(lm.Soma.WT18.HT18), xlab=expression(paste(hat (e), \" from LG18 on WT18 and HT18\")), ylab=expression(paste(hat (e), \" from Soma on WT18 and HT18\")), loess.p=FALSE)\n\n### identify case numbers for two unusual point\n\ni.unusual <- identify(resid(lm.LG18.WT18.HT18),resid(lm.Soma.WT18.HT18),n=2)\ni.unusual  # 61 68\n\n### redo plot with unusual points marked ...\n\nlm.e.Soma.WT18.HT18.e.LG18.WT18.HT18 <- scatterplot.with.reg.line(resid(lm.LG18.WT18.HT18), resid(lm.Soma.WT18.HT18), xlab=expression(paste(hat (e), \" from LG18 on WT18 and HT18\")), ylab=expression(paste(hat (e), \" from Soma on WT18 and HT18\")), loess.p=FALSE, label.me=i.unusual, pos=4)\n\n### overhead III-66 ... fake data for Stefani\n\nset.seed(42)\nWT18.Stefani <- sample(BGSgirls$WT18,1)\nHT18.Stefani <- sample(BGSgirls$HT18,1)\nLG18.Stefani <- sample(BGSgirls$LG18,1)\nround(c(WT18.Stefani, HT18.Stefani, LG18.Stefani),1)  # 67.4 166.8  35.1\n\n### overhead III-67 ... prediction of Soma for Stefani\n\nround(x.Stefani <- c(1, WT18.Stefani, HT18.Stefani, LG18.Stefani),1)\nround(as.vector(coef(lm.Soma.WT18.HT18.LG18)),3)\nround(y.Stefani <- sum(x.Stefani*coef(lm.Soma.WT18.HT18.LG18)), 1)\n\np <- 3\nn.BGSgirls-(p+1)  # 66\nalpha <- 0.05\nround(qt(alpha/2,n.BGSgirls-(p+1),lower=FALSE),4)  # 1.9966\n\nsigma.hat <- sqrt(sum(resid(lm.Soma.WT18.HT18.LG18)^2)/(n.BGSgirls-(p+1)))\nround(sepred.Stefani <- as.vector(sigma.hat*sqrt(1 + x.Stefani %*% XtXinv.BGSgirls %*% x.Stefani)), 4)\n\nround(y.Stefani - qt(alpha/2,n.BGSgirls-(p+1),lower=FALSE) * sepred.Stefani,1)\nround(y.Stefani + qt(alpha/2,n.BGSgirls-(p+1),lower=FALSE) * sepred.Stefani,1)\n\n### redo above, using predict function\n\nStefani.df <- data.frame(WT18=WT18.Stefani, HT18=HT18.Stefani, LG18=LG18.Stefani)\n\nround(predict(lm.Soma.WT18.HT18.LG18, newdata=Stefani.df, int=\"p\"),1)\n\n### reproduction of Chapter 4 overheads ...\n\n### overhead IV-2 ... look at coefficients for fitted models for Forbes data\n\nX.Forbes <- Forbes$bp\nY.Forbes <- log10(Forbes$pres)\nU.Forbes <- 1/(5*X.Forbes/9 + 255.37)\n\ncoef(lm(Y.Forbes ~ U.Forbes + X.Forbes))\ncoef(lm(Y.Forbes ~ U.Forbes))\ncoef(lm(Y.Forbes ~ X.Forbes))\n\n### overhead IV-3 ... 4-regressor model for BGS girls\n\nsummary(lm.Soma.WT18.HT18.LG18 <- lm(Soma ~ WT18 + HT18 + LG18, data=BGSgirls))\n\n### overhead IV-4 ... 3-regressor model for BGS girls\n\nsummary(lm.Soma.WT18.HT18 <- lm(Soma ~ WT18 + HT18, data=BGSgirls))\n\n### overhead IV-5 ... enhanced scatterplot matrix\n\nscatterplotMatrix(BGSgirls[,c(\"WT18\",\"HT18\",\"LG18\",\"Soma\")])\n\n### overhead IV-6 ... 2-regressor models for BGS girls\n\nsummary(lm.Soma.WT18 <- lm(Soma ~ WT18, data=BGSgirls))\n\nsummary(lm.Soma.HT18 <- lm(Soma ~ HT18, data=BGSgirls))\n\nround(coef(lm.Soma.WT18)[2],3)  # 0.067\n\nround(sqrt(vcov(lm.Soma.WT18)[2,2]),3)  # 0.008\n\nround(coef(lm.Soma.WT18.HT18)[2],3)\n\nround(sqrt(vcov(lm.Soma.WT18.HT18)[2,2]),3)  # 0.008\n\ncoef(lm.Soma.HT18)[2] > 0  # TRUE\n\ncoef(lm.Soma.WT18.HT18)[3] < 0  # TRUE\n\nsummary(lm.Soma.HT18)  # HT18 coefficient is not significantly different from 0\n\nsummary(lm.Soma.WT18.HT18)  # HT18 coefficient is significantly different from 0\n\n### overhead IV-7 ... models for BGS girls\n\nround(coef(lm.Soma.WT18)[2],4)  # 0.0667\nround(coef(lm.Soma.WT18.HT18)[2],4)  # 0.0879\n\nround(coef(lm.Soma.WT18.HT18)[2:3],4)  # 0.0879 -0.0606\n\n### overhead IV-10 ... effects plot for WT18\n\n(n.BGS <- length(BGSgirls$WT18))  # 70\np.BGS <- 2\n\nsigma.hat.BGS <- sqrt(sum(resid(lm.Soma.WT18.HT18)^2)/(n.BGS-(p.BGS+1)))\n\nX.BGS <- cbind(rep(1,n.BGS),BGSgirls$WT18,BGSgirls$HT18)\nXpX.BGS <- t(X.BGS) %*% X.BGS\nXpXinv.BGS <- solve(XpX.BGS)\n\nHT18.bar <- mean(BGSgirls$HT18)\n\nweights.BGS <- 40:100\n\n(n.weights.BGS <- length(weights.BGS))  # 61\n\nfit.BGS <- as.vector(cbind(rep(1,n.weights.BGS),weights.BGS,rep(HT18.bar,n.weights.BGS)) %*% coef(lm.Soma.WT18.HT18))\n                      \nget.sefit <- function(wt18)\n    {\n        x <- c(1,wt18,HT18.bar)\n        sqrt(as.vector(x %*% XpXinv.BGS %*% x))*sigma.hat.BGS\n    }\n\n\nsefit.BGS <- sapply(weights.BGS,get.sefit)\n\nupper.BGS <- fit.BGS + sefit.BGS * qt(0.025,n.BGS-(p.BGS+1),lower=FALSE)\nlower.BGS <- fit.BGS - sefit.BGS * qt(0.025,n.BGS-(p.BGS+1),lower=FALSE)\n\nplot(weights.BGS,fit.BGS,ylim=range(c(upper.BGS,lower.BGS)),xlab=\"WT18\",ylab=\"Soma\",col=\"blue\",typ=\"l\",lwd=2)\nlines(weights.BGS,upper.BGS,col=\"red\",lwd=2)\nlines(weights.BGS,lower.BGS,col=\"red\",lwd=2)\n\n### another way to generate effects plot ...\n\neff.plot.WT18 <- predict(lm.Soma.WT18.HT18, newdata=data.frame(WT18=weights.BGS,HT18=rep(HT18.bar,n.weights.BGS)), se.fit=TRUE)\n\nupper.BGS.WT18 <- eff.plot.WT18$fit + eff.plot.WT18$se.fit * qt(0.025,n.BGS-(p.BGS+1),lower=FALSE)\nlower.BGS.WT18 <- eff.plot.WT18$fit - eff.plot.WT18$se.fit * qt(0.025,n.BGS-(p.BGS+1),lower=FALSE)\n\nplot(weights.BGS,eff.plot.WT18$fit,ylim=range(c(upper.BGS.WT18,lower.BGS.WT18)),xlab=\"WT18\",ylab=\"Soma\",col=\"blue\",typ=\"l\",lwd=2)\nlines(weights.BGS,upper.BGS.WT18,col=\"red\",lwd=2)\nlines(weights.BGS,lower.BGS.WT18,col=\"red\",lwd=2)\n\n### third way to generate a similar plot ...\n###\nplot(Effect(\"WT18\",lm.Soma.WT18.HT18))\n\n### overhead IV-11 ... effects plot for HT18\n\nWT18.bar <- mean(BGSgirls$WT18)\n\nheights.BGS <- 150:185\n(n.heights.BGS <- length(heights.BGS))  # 36\n\neff.plot.HT18 <- predict(lm.Soma.WT18.HT18, newdata=data.frame(WT18=rep(WT18.bar,n.heights.BGS),HT18=heights.BGS), se.fit=TRUE)\n\nupper.BGS.HT18 <- eff.plot.HT18$fit + eff.plot.HT18$se.fit * qt(0.025,n.BGS-(p.BGS+1),lower=FALSE)\nlower.BGS.HT18 <- eff.plot.HT18$fit - eff.plot.HT18$se.fit * qt(0.025,n.BGS-(p.BGS+1),lower=FALSE)\n\nplot(heights.BGS,eff.plot.HT18$fit,ylim=range(c(upper.BGS.WT18,lower.BGS.WT18)),xlab=\"HT18\",ylab=\"Soma\",col=\"blue\",typ=\"l\",lwd=2)\nlines(heights.BGS,upper.BGS.HT18,col=\"red\",lwd=2)\nlines(heights.BGS,lower.BGS.HT18,col=\"red\",lwd=2)\n\n### another way to generate a similar plot ...\n\nplot(Effect(\"HT18\",lm.Soma.WT18.HT18))\n\n### overhead IV-12 ... coefficients associated with HT18\n\nround(coef(lm.Soma.HT18)[2],5)       #  0.00178\nround(coef(lm.Soma.WT18.HT18)[3],5)  # -0.06062\nround(coef(lm.Soma.HT18.LG18)[2],5)  # -0.023\n\nsummary(lm.Soma.HT18)       # HT18 not significant\nsummary(lm.Soma.WT18.HT18)  # HT18 highly significant\nsummary(lm.Soma.HT18.LG18)  # HT18 not significant\n\n### overhead IV-13 ... scatterplot matrix for WT2, WT9, WT18 and Soma\n\npairs(~ WT2 + WT9 + WT18 + Soma, data=BGSgirls, col=\"blue\")\n\n### overhead IV-14 ... enhanced scatterplot matrix\n\nscatterplotMatrix(BGSgirls[,c(\"WT2\",\"WT9\",\"WT18\",\"Soma\")])\n\n### overhead IV-15 ... 4 regressor model with 3 ages\n\nsummary(lm.Soma.WT.3.ages <-  lm(Soma ~ WT2 + WT9 + WT18, data=BGSgirls))\n\n### overhead IV-16 ... 4 regressor model with WT2, DW9 and DW18\n\nBGSgirls$DW9  <- BGSgirls$WT9 - BGSgirls$WT2\nBGSgirls$DW18 <- BGSgirls$WT18 - BGSgirls$WT9\n\nsummary(lm.Soma.WT2.DW9.DW18 <-  lm(Soma ~ WT2 + DW9 + DW18, data=BGSgirls))\n\n### overhead IV-17 ... comparison of WT2 coefficients\n\nround(coef(lm.Soma.WT.3.ages)[2],5)  # -0.11564\nsummary(lm.Soma.WT.3.ages)  # p-value for WT2 is 0.065\n\nround(coef(lm.Soma.WT2.DW9.DW18)[2],5)  # -0.01106\nsummary(lm.Soma.WT2.DW9.DW18)  # p-value for WT2 is 0.832\n\nround(coef(lm.Soma.WT2.DW9.DW18)[2]/coef(lm.Soma.WT.3.ages)[2],1)  # 0.1\n\n### overhead IV-18 ... comparison of WT18 and DW18 coefficients\n\nround(coef(lm.Soma.WT.3.ages)[4],5)     # 0.04834\nround(coef(lm.Soma.WT2.DW9.DW18)[4],5)  # 0.04834\n\nall.equal(as.vector(coef(lm.Soma.WT.3.ages)[4]), as.vector(coef(lm.Soma.WT2.DW9.DW18)[4]))  # TRUE\n\n### overhead IV-20 ... scatterplot matrix for 5 variables\n\npairs(~ WT2 + WT9 + WT18 + DW18 + Soma, data=BGSgirls, col=\"blue\")\n\n### overhead IV-21 ... enhanced scatterplot matrix\n\nscatterplotMatrix(BGSgirls[,c(\"WT2\",\"WT9\",\"WT18\",\"DW18\",\"Soma\")])\n\n### overhead IV-23 ... residuals versus fitted values for response Soma\n\nplot(fitted(lm.Soma.WT.3.ages), resid(lm.Soma.WT.3.ages), xlab=\"Fitted values\", ylab=\"Residuals\", col=\"blue\")\nabline(h=0, lty=\"dashed\", lwd=2)\n\n### overhead IV-24 ... residuals versus fitted values for response DW18\n\nlm.DW18.WT2.WT9.WT18 <-  lm(DW18 ~ WT2 + WT9 + WT18, data=BGSgirls)\n\n### use this to identify two points away from other points \n\nplot(fitted(lm.DW18.WT2.WT9.WT18),resid(lm.DW18.WT2.WT9.WT18))\n(two.oddballs <- identify(fitted(lm.DW18.WT2.WT9.WT18),resid(lm.DW18.WT2.WT9.WT18),n=2))  # 1 68\n\n### now recreate what is shown on IV-24\n\nplot(fitted(lm.DW18.WT2.WT9.WT18), resid(lm.DW18.WT2.WT9.WT18), xlab=\"Fitted values\", ylab=\"Residuals\", col=\"blue\")\nabline(h=0, lty=\"dashed\", lwd=2)\ntext(fitted(lm.DW18.WT2.WT9.WT18)[two.oddballs], resid(lm.DW18.WT2.WT9.WT18)[two.oddballs], two.oddballs, pos=1)\n\n### overhead IV-25 ... added-variable plot for DW18 with one point marked\n\nplot(resid(lm.DW18.WT2.WT9.WT18), resid(lm.Soma.WT.3.ages))\n(one.oddball <- identify(resid(lm.DW18.WT2.WT9.WT18), resid(lm.Soma.WT.3.ages),n=1))  # 1\n\nplot(resid(lm.DW18.WT2.WT9.WT18), resid(lm.Soma.WT.3.ages), xlab=expression(paste(hat (e), \" from DW18 on WT2, WT9 and WT18\")), ylab=expression(paste(hat (e), \" from Soma on WT2, WT9 and WT18\")), col=\"blue\")\nlm.added.variable <- lm( resid(lm.Soma.WT.3.ages) ~ resid(lm.DW18.WT2.WT9.WT18))\nabline(reg=lm.added.variable, lwd=2)\ntext(resid(lm.DW18.WT2.WT9.WT18)[one.oddball], resid(lm.Soma.WT.3.ages)[one.oddball], one.oddball, pos=3)\n\n### overhead IV-26 ... follow-on to added-variable plot\n\ncoef(lm.added.variable)[2]\n\nsummary(lm(Soma ~ WT2 + WT9 + WT18 + DW18, data=BGSgirls))\n\n### overhead IV-29 ... corrected version of IV-24 (replicated as IV-28) \n\nplot(fitted(lm.DW18.WT2.WT9.WT18), rep(0,length(resid(lm.DW18.WT2.WT9.WT18))), xlab=\"Fitted values\", ylab=\"Residuals\", col=\"blue\", ylim=range(resid(lm.DW18.WT2.WT9.WT18)))\nabline(h=0, lty=\"dashed\", lwd=2)\ntext(fitted(lm.DW18.WT2.WT9.WT18)[two.oddballs], rep(0,2), two.oddballs, pos=1)\n\n### overhead IV-31 ... corrected version of IV-25 (replicated as IV-30) \n\nplot(rep(0,length(resid(lm.DW18.WT2.WT9.WT18))), resid(lm.Soma.WT.3.ages), xlab=expression(paste(hat (e), \" from DW18 on WT2, WT9 and WT18\")), ylab=expression(paste(hat (e), \" from Soma on WT2, WT9 and WT18\")), col=\"blue\", xlim=range(resid(lm.DW18.WT2.WT9.WT18)))\ntext(0, resid(lm.Soma.WT.3.ages)[one.oddball], one.oddball, pos=4)\n\n### overhead IV-33 ... R^2 for 4 fitted models ...\n\nget.R.squared <- function(lm.obj)\n    {\n        1 - sum(resid(lm.obj)^2)/sum((lm.obj$model[[1]]-mean(lm.obj$model[[1]]))^2)\n    }\n\nget.R.squared(lm(Soma ~ WT2 + WT9  + WT18, data=BGSgirls))  # 0.5658419\nget.R.squared(lm(Soma ~ WT2 + WT9  + DW18, data=BGSgirls))  # 0.5658419\nget.R.squared(lm(Soma ~ WT2 + WT18 + DW18, data=BGSgirls))  # 0.5658419\n\nBGSgirls$AVE  <- with(BGSgirls, (WT2 + WT9 + WT18)/3)\nBGSgirls$LIN  <- with(BGSgirls, WT18 - WT2)\nBGSgirls$QUAD <- with(BGSgirls, WT2 - 2*WT9 + WT18)\nget.R.squared(lm(Soma ~ AVE + LIN + QUAD, data=BGSgirls))  # 0.5658419\n\n### overhead IV-39 ... simulated example\n\nset.seed(42)\nX1 <- rnorm(100)\nX2 <- rnorm(100)\nY <- 5 - X1 + X2 + rnorm(100,sd=0.1)\nbeta.2 <- 1\nsigma.squared <- 0.01\n\n### overhead IV-40 ... small calculation\n\nround(sqrt(sigma.squared + beta.2^2),3)  # 1.005\n\n### overhead IV-41 ... summary of fitted linear model\n\nsummary(lm(Y ~ X1 + X2))\n\n### overhead IV-42 ... summary of fitted linear model\n\nsummary(lm(Y ~ X1))\n\n### overhead IV-45 ... another simulated example, which needs a function\n### (mvrnorm) that lives in the package MASS - if you don't have this\n### package installed, use the following to install it:\n###\n### install.packages(\"MASS\", dependencies=TRUE, repos=\"http://cran.fhcrc.org\")\n\nlibrary(MASS)\n\nrho.X1.X2 <- 0.9\nvar.X1 <- rho.X1.X2^2 * (1 - rho.X1.X2^2) \nvar.X2 <- 1 - rho.X1.X2^2\ncov.X1.X2 <- rho.X1.X2 * sqrt(var.X1 * var.X2)\nset.seed(42)\nX1.X2 <- mvrnorm(100,c(0,0),\n                 matrix(c(var.X1, cov.X1.X2,\n                          cov.X1.X2, var.X2),2,2))\nX1 <- X1.X2[,1]\nX2 <- X1.X2[,2]\nY <- 5 - X1 + X2 + rnorm(100,sd=0.1)\n\n### overhead IV-46 ... verification of short calculation\n\nround(nu.squared <- (1-rho.X1.X2^2)^2,4)  # 0.0361\n\n### overhead IV-47 ... verification of more calculations\n\nround(0.01 + nu.squared,4)  # 0.0461\nround(sqrt(0.01 + nu.squared),4)  # 0.2147\n\n### as an aside, let's do a small experiment to see if we get the conditional\n### variance stated above (WARNING: execution of the following code might take\n### a minute or two)\n\nset.seed(42)\nn.reps <- 10000\nRMSE.lots <- rep(0, n.reps)\nfor(i in 1:n.reps)\n  {\n    X1.X2.new <- mvrnorm(100,c(0,0),\n                     matrix(c(var.X1, cov.X1.X2,\n                              cov.X1.X2, var.X2),2,2))\n    X1.new <- X1.X2.new[,1]\n    X2.new <- X1.X2.new[,2]\n    Y.new <- 5 - X1.new + X2.new + rnorm(100,sd=0.1)\n    RMSE.lots[i] <- sum(resid(lm(Y.new ~ X1.new))^2)/98\n  }\n\nround(sqrt(mean(RMSE.lots)),4)  # 0.2147 - exactly what theory says!!!\n\n### overhead IV-48 ... scatterplot matrix\n\npairs(~ X1 + X2 + Y, col=\"blue\")\n\n### overhead IV-49 ... enhanced scatterplot matrix\n\nscatterplotMatrix(data.frame(X1, X2, Y))\n\n### overhead IV-50 ... summary of fitted model using two regressors\n\nsummary(lm(Y ~ X1 + X2))\n\n### overhead IV-51 ... summary of fitted model using one regressor\n\nsummary(lm(Y ~ X1))\n\n### overhead IV-52 ... summary of fitted model using the other regressor\n\nsummary(lm(Y ~ X2))\n\n### overhead IV-53 ... extraction of R squareds\n\nround(get.R.squared(lm(Y ~ X1))*100,1)  # 0\nround(get.R.squared(lm(Y ~ X2))*100,1)  # 11.4\nround(get.R.squared(lm(Y ~ X1 + X2))*100,1)  # 76\n",
    "created" : 1453281454369.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1913255710",
    "id" : "592D20FC",
    "lastKnownWriteTime" : 1453281442,
    "path" : "~/Downloads/423-lab-05.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}