{
    "contents" : "#########\n# lm example\n# create a dataset\nlibrary(alr4)\n\n\nBGSgirls\nhead(BGSgirls)\nwith(BGSgirls,plot(HT2,HT18))\n\nlm.BGS = lm(HT18~HT2,data = BGSgirls)\nlm.BGS\n\n# coefficient\nlm.BGS$coefficients\ncoef(lm.BGS)\ncoefficients(lm.BGS)\n\ndf = lm.BGS$df.residual\n\nlm.BGS$\n  \n# variance of coefficient\nvcov(lm.BGS)\n\n# residual \nlm.BGS$residuals\nresid(lm.BGS)\n\n# fitted value\nlm.BGS$fitted.values\nfitted(lm.BGS)\nfitted.values(lm.BGS)\n\nplot(lm.BGS)\n\npar(mfrow=c(2,2))\nplot(lm.BGS)\nplot(lm.BGS,mgp=c(2,1,0.5))\n\n\npar(mar=c(0.5, 0.5, 0.2, 0.2), mfrow=c(2,2),\n    oma = c(2, 2, 0.2, 0.2))\n\nplot(lm.BGS)\n\n#residual plot\npar(mfrow=c(1,1),mar=c(4,4,2,1),oma=c(0,0,1,0))\nwith(lm.BGS,plot(fitted.values,residuals,pch=20,cex=1,xlab=\"fitted\",ylab=\"residual\"))\nabline(h=0, lty=2)\n\n# check normality assumption\nqqnorm(resid(lm.BGS))\nqqline(resid(lm.BGS))\n\n## Summary objects\nsum.BGS = summary(lm.BGS)\nsum.BGS\n\n\nsum.BGS$residuals\n\nsum.BGS$coefficients\n\n# estimated intercept and slope beta\nbeta = sum.BGS$coefficients[,1]\n\nBGS.fitted = beta[0] + beta[1] * BGSgirls$HT2\n\nsum.BGS\nBGS.t = beta/sum.BGS$coefficients[,2]\nBGS.t\nBGS.p = 2 * (1 - pt(abs(BGS.t),df))\nBGS.p\n\n# sigma^2\n\nsum.BGS$sigma\n\nsqrt(sum(sum.BGS$residuals^2)/df)\n\n# make prediction\nwith(BGSgirls,plot(HT2,HT18,pch=20))\nabline(lm.BGS)\n# predict for the point HT = 84,93,96\npredict(lm.BGS)\nall.equal(predict(lm.BGS),fitted(lm.BGS))\npredict(lm.BGS,newdata=84) # wrong?\npredict(lm.BGS,newdata=c(84,93,96)) # wrong?\n\n# use dataframe\npredict(lm.BGS,newdata=data.frame(HT2=84))\npredict(lm.BGS,newdata=data.frame(HT2=c(84,94,96)))\n\n####################################3\n\n(n.Anscombe <- with(anscombe,length(x1)))  # 11\n\nx.bar.Anscombe.1 <- with(anscombe,mean(x1))\ny.bar.Anscombe.1 <- with(anscombe,mean(y1))\nSXX.Anscombe.1 <- with(anscombe,(n.Anscombe-1)*var(x1))\nSYY.Anscombe.1 <- with(anscombe,(n.Anscombe-1)*var(y1))\nSXY.Anscombe.1 <- with(anscombe,(n.Anscombe-1)*cov(x1,y1))\n\nx.bar.Anscombe.2 <- with(anscombe,mean(x2))\ny.bar.Anscombe.2 <- with(anscombe,mean(y2))\nSXX.Anscombe.2 <- with(anscombe,(n.Anscombe-1)*var(x2))\nSYY.Anscombe.2 <- with(anscombe,(n.Anscombe-1)*var(y2))\nSXY.Anscombe.2 <- with(anscombe,(n.Anscombe-1)*cov(x2,y2))\n\nx.bar.Anscombe.3 <- with(anscombe,mean(x3))\ny.bar.Anscombe.3 <- with(anscombe,mean(y3))\nSXX.Anscombe.3 <- with(anscombe,(n.Anscombe-1)*var(x3))\nSYY.Anscombe.3 <- with(anscombe,(n.Anscombe-1)*var(y3))\nSXY.Anscombe.3 <- with(anscombe,(n.Anscombe-1)*cov(x3,y3))\n\nx.bar.Anscombe.4 <- with(anscombe,mean(x4))\ny.bar.Anscombe.4 <- with(anscombe,mean(y4))\nSXX.Anscombe.4 <- with(anscombe,(n.Anscombe-1)*var(x4))\nSYY.Anscombe.4 <- with(anscombe,(n.Anscombe-1)*var(y4))\nSXY.Anscombe.4 <- with(anscombe,(n.Anscombe-1)*cov(x4,y4))\n\nall.equal(x.bar.Anscombe.1,x.bar.Anscombe.2)  # TRUE\nall.equal(x.bar.Anscombe.2,x.bar.Anscombe.3)  # TRUE\nall.equal(x.bar.Anscombe.3,x.bar.Anscombe.4)  # TRUE\n\nall.equal(y.bar.Anscombe.1,y.bar.Anscombe.2)  # TRUE  \nall.equal(y.bar.Anscombe.2,y.bar.Anscombe.4)  # TRUE\nall.equal(y.bar.Anscombe.2,y.bar.Anscombe.3)  # \"Mean relative difference: 0.0001211974\"\ny.bar.Anscombe.2  # 7.500909\ny.bar.Anscombe.3  # 7.5\n\nall.equal(SXX.Anscombe.1,SXX.Anscombe.2)  # TRUE\nall.equal(SXX.Anscombe.2,SXX.Anscombe.3)  # TRUE\nall.equal(SXX.Anscombe.3,SXX.Anscombe.4)  # TRUE\n\nSYY.Anscombe.1  # 41.27269\nSYY.Anscombe.2  # 41.27629\nSYY.Anscombe.3  # 41.2262 \nSYY.Anscombe.4  # 41.23249\n\nSXY.Anscombe.1  # 55.01\nSXY.Anscombe.2  # 55   \nSXY.Anscombe.3  # 54.97\nSXY.Anscombe.4  # 54.99\n\n(beta.1.hat.Anscombe.1 <- SXY.Anscombe.1/SXX.Anscombe.1)  # 0.5000909\n(beta.1.hat.Anscombe.2 <- SXY.Anscombe.2/SXX.Anscombe.2)  # 0.5      \n(beta.1.hat.Anscombe.3 <- SXY.Anscombe.3/SXX.Anscombe.3)  # 0.4997273\n(beta.1.hat.Anscombe.4 <- SXY.Anscombe.4/SXX.Anscombe.4)  # 0.4999091\n\n(beta.0.hat.Anscombe.1 <- y.bar.Anscombe.1 - beta.1.hat.Anscombe.1*x.bar.Anscombe.1)  # 3.000091\n(beta.0.hat.Anscombe.2 <- y.bar.Anscombe.2 - beta.1.hat.Anscombe.2*x.bar.Anscombe.2)  # 3.000909\n(beta.0.hat.Anscombe.3 <- y.bar.Anscombe.3 - beta.1.hat.Anscombe.3*x.bar.Anscombe.3)  # 3.002455\n(beta.0.hat.Anscombe.4 <- y.bar.Anscombe.4 - beta.1.hat.Anscombe.4*x.bar.Anscombe.4)  # 3.001727\n\n### overhead II-73 ... Anscombe's first data set\n\nwith(anscombe,plot(x1,y1,xlim=c(3,20),ylim=c(2,14),xlab=\"Predictor\", ylab=\"Response\",col=\"blue\"))\nabline(beta.0.hat.Anscombe.1,beta.1.hat.Anscombe.1,lwd=2,col=\"blue\")\n\n\n### overhead II-74 ... Anscombe's second data set\n\nwith(anscombe,plot(x2,y2,xlim=c(3,20),ylim=c(2,14),xlab=\"Predictor\", ylab=\"Response\",col=\"blue\"))\nabline(beta.0.hat.Anscombe.2,beta.1.hat.Anscombe.2,lwd=2,col=\"blue\")\n\n### overhead II-75 ... Anscombe's third data set\n\nwith(anscombe,plot(y3))  # to figure out index of separated point\n\nwith(anscombe,plot(x3,y3,xlim=c(3,20),ylim=c(2,14),xlab=\"Predictor\", ylab=\"Response\",col=\"blue\"))\nabline(beta.0.hat.Anscombe.3,beta.1.hat.Anscombe.3,lwd=2,col=\"blue\")\nwith(anscombe,points(x3[3],y3[3],pch=20,col=\"red\"))\n\n### overhead II-76 ... Anscombe's fourth data set\n\nwith(anscombe,plot(x4))  # to figure out index of separated point\n\nwith(anscombe,plot(x4,y4,xlim=c(3,20),ylim=c(2,14),xlab=\"Predictor\", ylab=\"Response\",col=\"blue\"))\nabline(beta.0.hat.Anscombe.4,beta.1.hat.Anscombe.4,lwd=2,col=\"blue\")\nwith(anscombe,points(x4[8],y4[8],pch=20,col=\"red\"))\n\n### overhead II-78 ... residuals vs. fitted values, data set #1\n\nfitted.Anscombe.1 <- with(anscombe,beta.0.hat.Anscombe.1 + beta.1.hat.Anscombe.1*x1)\nresiduals.Anscombe.1 <- with(anscombe,y1 - fitted.Anscombe.1)\n\nwith(anscombe,plot(fitted.Anscombe.1,residuals.Anscombe.1,xlab=\"Fitted values\", ylab=\"Residuals\",col=\"blue\"))\nabline(h=0,lty=\"dashed\")\n\n\n### overhead II-80 ... residuals vs. fitted values, data set #2\n\nfitted.Anscombe.2 <- with(anscombe,beta.0.hat.Anscombe.2 + beta.1.hat.Anscombe.2*x2)\nresiduals.Anscombe.2 <- with(anscombe,y2 - fitted.Anscombe.2)\n\nwith(anscombe,plot(fitted.Anscombe.2,residuals.Anscombe.2,xlab=\"Fitted values\", ylab=\"Residuals\",col=\"blue\"))\nabline(h=0,lty=\"dashed\")\n\n### overhead II-81 ... residuals vs. predictors, data set #2\n\nwith(anscombe,plot(x2,residuals.Anscombe.2,xlab=\"Predictors\", ylab=\"Residuals\",col=\"blue\"))\nabline(h=0,lty=\"dashed\")\n\n### overhead II-82 ... residuals vs. fitted values, data set #3\n\nfitted.Anscombe.3 <- with(anscombe,beta.0.hat.Anscombe.3 + beta.1.hat.Anscombe.3*x3)\nresiduals.Anscombe.3 <- with(anscombe,y3 - fitted.Anscombe.3)\n\nwith(anscombe,plot(fitted.Anscombe.3,residuals.Anscombe.3,xlab=\"Fitted values\", ylab=\"Residuals\",col=\"blue\"))\nabline(h=0,lty=\"dashed\")\n\n### overhead II-83 ... residuals vs. predictors, data set #3\n\nwith(anscombe,plot(x3,residuals.Anscombe.3,xlab=\"Predictors\", ylab=\"Residuals\",col=\"blue\"))\nabline(h=0,lty=\"dashed\")\n\n### overhead II-84 ... residuals vs. fitted values, data set #4\n\nfitted.Anscombe.4 <- with(anscombe,beta.0.hat.Anscombe.4 + beta.1.hat.Anscombe.4*x4)\nresiduals.Anscombe.4 <- with(anscombe,y4 - fitted.Anscombe.4)\n\nwith(anscombe,plot(fitted.Anscombe.4,residuals.Anscombe.4,xlab=\"Fitted values\", ylab=\"Residuals\",col=\"blue\"))\nabline(h=0,lty=\"dashed\")\n\n### overhead II-86 ... fitted values and predictions are linearly related ...\n\nwith(anscombe,plot(x1,fitted.Anscombe.1,xlab=\"Predictors\", ylab=\"Fitted values\",col=\"blue\"))\nwith(anscombe,abline(lm(fitted.Anscombe.1~x1),lwd=2))\n\nwith(anscombe,plot(x2,fitted.Anscombe.2,xlab=\"Predictors\", ylab=\"Fitted values\",col=\"blue\"))\nwith(anscombe,abline(lm(fitted.Anscombe.2~x2),lwd=2))\n\nwith(anscombe,plot(x3,fitted.Anscombe.3,xlab=\"Predictors\", ylab=\"Fitted values\",col=\"blue\"))\nwith(anscombe,abline(lm(fitted.Anscombe.3~x3),lwd=2))\n\nwith(anscombe,plot(x4,fitted.Anscombe.4,xlab=\"Predictors\", ylab=\"Fitted values\",col=\"blue\"))\nwith(anscombe,abline(lm(fitted.Anscombe.4~x4),lwd=2))\n\n\n##########################\n\n\n# simulation example\nset.seed(423)\n#generate x\n\nx = rnorm(50,2,3)\n\nbeta0 = numeric(5000)\nbeta1 = numeric(5000)\nt_beta1 = numeric(5000)\nfor(i in 1:5000){\n  y = 2 + 0 * x + rnorm(50,0,1)\n  lm.0 = lm(y~x)\n  summary.0 = summary(lm.0)\n  beta0[i] = lm.0$coefficients[1]\n  beta1[i] = lm.0$coefficients[2]\n  t_beta1[i] = summary.0$coefficients[2,4]\n}\n\nmean(t_beta1 < 0.05)\nmean(t_beta1 < 0.1)\nhist(t_beta1)\n\nhist(beta0)\nhist(beta1)\n\nplot(beta0,beta1)\n\n\n\n\n",
    "created" : 1453197941527.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2341841527",
    "id" : "8B7BF9C3",
    "lastKnownWriteTime" : 1453857884,
    "path" : "~/Dropbox/423/423codes/lab3.R",
    "project_path" : "lab3.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}